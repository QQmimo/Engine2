var P=Object.defineProperty;var G=(o,e,t)=>e in o?P(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>G(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class T{constructor(e){i(this,"Object");this.Object=e}update(e){}}class E{static new(){const e="0123456789ABCDEF";return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/x/g,()=>e.charAt(Math.random()*e.length))}}class h{constructor(e,t){i(this,"X");i(this,"Y");this.X=e,this.Y=t}add(e){return new h(this.X+e.X,this.Y+e.Y)}subtract(e){return new h(this.X-e.X,this.Y-e.Y)}normalize(){const e=this.length;return new h(this.X/e,this.Y/e)}dot(e){return this.X*e.X+this.Y*e.Y}multiply(e){return new h(this.X*e,this.Y*e)}distance(e){return this.subtract(e).length}get length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}}class g extends Number{toDegree(){return this.valueOf()*180/Math.PI}toRadian(){return this.valueOf()}static degree(e){return new g(e*Math.PI/180)}static byPoints(e,t){const s=e instanceof d?e.Transform.Position:e,n=t instanceof d?t.Transform.Position:t;return new g(Math.atan2(n.Y-s.Y,n.X-s.X))}}class X{constructor(e,t){i(this,"Width");i(this,"Height");this.Width=e,this.Height=t}}class x{constructor(e,t,s=new X(1,1)){i(this,"_Scale");i(this,"_Width");i(this,"_Height");this._Scale=s,this._Width=e*s.Width,this._Height=t*s.Height}get Scale(){return this._Scale}set Scale(e){this._Scale=e}get Width(){return this._Width}set Width(e){this._Width=e*this.Scale.Width}get Height(){return this._Height}set Height(e){this._Height=e*this.Scale.Height}}class c{static Float(e,t){return typeof t>"u"?Math.random()*e:Math.random()*(t-e+1)+e}static Integer(e,t){return Math.floor(c.Float(e,t))}static ColorRGB(){return`rgb(${c.Integer(255)}, ${c.Integer(255)}, ${c.Integer(255)})`}static ColorHEX(){const e="0123456789ABCDEF";return"#xxxxxx".replace(/x/g,()=>e.charAt(Math.random()*e.length))}static Boolean(){return c.Integer(0,1)===1}static Angle(e=360){return g.degree(c.Integer(e))}static Vector2D(e,t){return new h(Math.random()*e,Math.random()*t)}}const m=class m{constructor(e){i(this,"Name");i(this,"Id");i(this,"Tags");i(this,"_onDestroy");i(this,"_onUpdate");this.Id=E.new(),this.Name=e,this.Tags=[],m.add(this)}onDestroy(e){this._onDestroy=e}onUpdate(e){this._onUpdate=e}addTag(e){this.Tags.push(e)}destroy(){var e;m.delete(this.Id),(e=this._onDestroy)==null||e.apply(this)}static get AllAsArray(){return Array.from(this.All,([e,t])=>t).filter(e=>e.constructor.name===this.name)}static add(e){if(m.findById(e.Id))throw new Error(`ОШИБКА: ${this.name} c идентификатором '${e.Id}' уже существует.`);this.All.set(e.Id,e)}static findById(e){return this.AllAsArray.find(t=>this.name===t.constructor.name&&t.Id===e)??null}static findByName(e){return this.AllAsArray.find(t=>this.name===t.constructor.name&&t.Name===e)??null}static selectByTag(e){return this.AllAsArray.filter(t=>t.Tags.includes(e))}static showAll(){return this.AllAsArray}static delete(e){this.All.delete(e)}};i(m,"All",new Map);let p=m;class w extends p{constructor(t,s,n,r){super(s??`GameScreen_${w.showAll().length+1}`);i(this,"_LastTime",0);i(this,"_Loop",0);i(this,"_GameEngine",new Y);i(this,"Scenes");i(this,"Canvas");i(this,"Context");i(this,"_onAddScene");i(this,"play",(t=0)=>{const s=(t-this._LastTime)/1e3;this._LastTime=t,this.update(s),this._Loop=requestAnimationFrame(this.play)});this.Scenes=new Map,this.Canvas=document.createElement("canvas"),this.Context=this.Canvas.getContext("2d"),t.appendChild(this.Canvas),this._setSize(),window.addEventListener("resize",()=>{this._setSize()})}_setSize(){this.Canvas.width=innerWidth,this.Canvas.height=innerHeight,this.Canvas.style.cssText="position: absolute; top: 0; left: 0;"}get Width(){return this.Canvas.width}get Height(){return this.Canvas.height}onAddScene(t){this._onAddScene=t}addScene(t){var n;const s=new _(this,t);if(this.findSceneById(s.Id)!==null)throw new Error(`ОШИБКА: ${s.constructor.name} с идентификатором '${s.Id}' уже существует.`);return this.Scenes.set(s.Id,s),(n=this._onAddScene)==null||n.apply(this,[s]),s}destroyScene(t){var s;(s=_.findById(t))==null||s.destroy()}findSceneById(t){return this.Scenes.get(t)??null}update(t){var s;this._GameEngine.update(t),(s=this.Context)==null||s.clearRect(0,0,this.Width,this.Height),this.Scenes.forEach(n=>{var r;n.update(t),(r=this.Context)==null||r.restore()})}pause(){cancelAnimationFrame(this._Loop)}destroy(){var t;(t=this.Canvas.parentElement)==null||t.removeChild(this.Canvas),this.Scenes.forEach(s=>s.destroy()),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return this.AllAsArray}}class _ extends p{constructor(t,s){super(s??`GameScene_${_.showAll().length+1}`);i(this,"Layers");i(this,"Screen");i(this,"_onAddLayer");this.Layers=new Map,this.Screen=t}onAddLayer(t){this._onAddLayer=t}update(t){this.Layers.forEach(s=>s.update(t))}addLayer(t){var n;const s=new S(this,t);if(this.findLayerById(s.Id)!==null)throw new Error(`ОШИБКА: ${s.constructor.name} с идентификатором '${s.Id}' уже существует.`);return this.Layers.set(s.Id,s),(n=this._onAddLayer)==null||n.apply(this,[s]),s}destroyLayer(t){var s;(s=this.findLayerById(t))==null||s.destroy()}findLayerById(t){return this.Layers.get(t)??null}destroy(){this.Layers.forEach(t=>t.destroy()),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return super.showAll()}}class S extends p{constructor(t,s){super(s??`GameLayer_${S.showAll().length+1}`);i(this,"Objects");i(this,"Scene");i(this,"_onAddObject");this.Objects=new Map,this.Scene=t}onAddObject(t){this._onAddObject=t}update(t){this.Objects.forEach(s=>s.update(t))}createObject(t){var n;const s=new d(this,t);if(this.findObjectById(s.Id)!==null)throw new Error(`ОШИБКА: ${s.constructor.name} с идентификатором '${s.Id}' уже существует.`);return this.Objects.set(s.Id,s),(n=this._onAddObject)==null||n.apply(this,[s]),s}addObject(t){var s;return this.Objects.set(t.Id,t),(s=this._onAddObject)==null||s.apply(this,[t]),t}destroyObject(t){this.Objects.delete(t)}findObjectById(t){return this.Objects.get(t)??null}destroy(){this.Objects.forEach(t=>t.destroy()),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return super.showAll()}}class d extends p{constructor(t,s){super(s??`GameObject_${d.showAll().length+1}`);i(this,"_Layer");i(this,"Components");this.Components=new Map,this.Layer=t,[M].forEach(n=>this.addComponent(n))}get Layer(){return this._Layer}set Layer(t){t.addObject(this),this._Layer=t}get Transform(){return this.getComponent(M)}addComponent(t){const s=new t(this);return this.Components.set(t.name,s),s}getComponent(t){const s=this.Components.get(t.name);if(s===void 0)throw new Error(`ОШИБКА: Компонент '${t.name}' не найден.`);return s}tryGetComponent(t){return this.Components.get(t.name)}destroyComponent(t){this.Components.delete(t.name)}update(t){var s;this.Components.forEach(n=>{n.update(t)}),(s=this._onUpdate)==null||s.apply(this,[t])}destroy(){this.Layer.destroyObject(this.Id),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return super.showAll()}static selectByComponent(t){return super.showAll().filter(s=>s instanceof d&&s.tryGetComponent(t))}}class Y{constructor(){i(this,"_Gravity",0);i(this,"_MetrByPixels",1)}get Gravity(){return this._Gravity*this.MetrByPixels}set Gravity(e){this._Gravity=e/this.MetrByPixels}get MetrByPixels(){return this._MetrByPixels}set MetrByPixels(e){const t=this._Gravity*this._MetrByPixels;this._MetrByPixels=e,this.Gravity=t}_updatePhysic(e){const t=d.selectByComponent(a);for(let s=0;s<t.length;s++){t[s].getComponent(y).Velocity=new h(0,this._Gravity);for(let n=t.length-1;n>=0&&t[s].Id!==t[n].Id;n--)t[s].getComponent(a).checkCollision(t[n])}}update(e){this._updatePhysic(e)}}class M extends T{constructor(){super(...arguments);i(this,"Position",new h(0,0));i(this,"Rotation",new g(0));i(this,"Size",new x(50,50));i(this,"Fill")}}class y extends T{constructor(){super(...arguments);i(this,"_Velocity",new h(0,0));i(this,"_Speed",0);i(this,"_Target",null);i(this,"_IsMoving",!1);i(this,"_onFinish");i(this,"_onChangeTarget");i(this,"_onMoving")}get Velocity(){return this._Velocity}set Velocity(t){this._Velocity=this._Velocity.add(t)}get Speed(){return this._Speed}set Speed(t){this._Speed=t}get Target(){return this._Target}set Target(t){var s;if(this._Target=t,this._Target!==null){const n=this._Target.subtract(this.Object.Transform.Position);this._Velocity=n.multiply(this.Speed/n.length)}(s=this._onChangeTarget)==null||s.apply(this,[this.Object,this])}get IsMoving(){return this._IsMoving}onFinish(t){this._onFinish=t}onChangeTarget(t){this._onChangeTarget=t}onMoving(t){this._onMoving=t}update(t){var s,n,r;if(this.Target!==null&&((s=this.Target)==null?void 0:s.subtract(this.Object.Transform.Position)).length<1){this._IsMoving=!1,(n=this._onFinish)==null||n.apply(this,[this.Object,this]);return}this.Object.Transform.Position=this.Object.Transform.Position.add(this._Velocity.multiply(t)),this._IsMoving=!0,(r=this._onMoving)==null||r.apply(this,[this.Object,this])}}class a extends T{constructor(){super(...arguments);i(this,"Mass",0);i(this,"Flex",.4);i(this,"_onCollision")}onCollision(t){this._onCollision=t}checkCollision(t){var r,l;return this.Object.Transform.Position.subtract(t.Transform.Position).length<this.Object.Transform.Size.Width+t.Transform.Size.Width?((r=this._onCollision)==null||r.apply(this,[t,this]),(l=t.getComponent(a)._onCollision)==null||l.apply(this,[this.Object,t.getComponent(a)]),this._bounce(t),!0):!1}_bounce(t){var B;let s=this.Object.tryGetComponent(y);s===null&&(s=this.Object.addComponent(y));const n=s.Velocity.subtract(((B=t.tryGetComponent(y))==null?void 0:B.Velocity)??new h(0,0)),r=this.Object.Transform.Position.X-t.Transform.Position.X,l=this.Object.Transform.Position.Y-t.Transform.Position.Y,I=Math.sqrt(r*r+l*l),f=new h(r/I,l/I).normalize(),A=n.dot(f);if(A>0)return;const L=-(1+this.Flex+t.getComponent(a).Flex)*A,O=(this.Mass!==1/0?1/this.Mass:0)+(t.tryGetComponent(a).Mass!==1/0?1/t.tryGetComponent(a).Mass:0),C=L/O;this.Mass!==1/0&&(s.Velocity.X+=C*f.X/this.Mass,s.Velocity.Y+=C*f.Y/this.Mass),t.tryGetComponent(a).Mass!==1/0&&(t.tryGetComponent(y).Velocity.X-=C*f.X/t.tryGetComponent(a).Mass,t.tryGetComponent(y).Velocity.Y-=C*f.Y/t.tryGetComponent(a).Mass)}}class v extends T{get _Screen(){return this.Object.Layer.Scene.Screen}update(e){this._Screen.Context.beginPath(),this._Screen.Context.arc(this.Object.Transform.Position.X,this.Object.Transform.Position.Y,this.Object.Transform.Size.Width,0,360),this._Screen.Context.fillStyle=this.Object.Transform.Fill,this._Screen.Context.fill(),this._Screen.Context.closePath()}}const u=new w(document.body),F=u.addScene(),b=F.addLayer();u.Canvas.onclick=o=>{const e=new d(b);e.addTag("black hole"),e.Transform.Position=new h(o.clientX,o.clientY),e.Transform.Fill="black",e.Transform.Size=new x(5,0),e.addComponent(v),e.addComponent(a);const t=e.getComponent(a);t.Mass=1/0,t.Flex=0,e.addComponent(y),e.onUpdate(()=>{d.selectByComponent(a).forEach(n=>{const r=e.Transform.Position.distance(n.Transform.Position);n.getComponent(y).Velocity=new h((e.Transform.Position.X-n.Transform.Position.X)/(r*r+.01),(e.Transform.Position.Y-n.Transform.Position.Y)/(r*r+.01))})})};u.Canvas.oncontextmenu=o=>{o.preventDefault(),d.selectByTag("black hole").forEach(t=>t.destroy())};for(let o=0;o<500;o++){const e=new d(b);e.Transform.Position=c.Vector2D(u.Width,u.Height),e.Transform.Size=new x(c.Integer(2,10),0),e.Transform.Fill="green",e.addComponent(v),e.addComponent(y),e.addComponent(a);const t=e.getComponent(y);t.Speed=25,t.Target=c.Vector2D(u.Width,u.Height),t.onFinish((n,r)=>{r.Target=c.Vector2D(u.Width,u.Height)});const s=e.getComponent(a);s.Mass=e.Transform.Size.Width*e.Transform.Size.Width,s.onCollision(n=>{n.Tags.includes("black hole")||(n.Transform.Fill="red",setTimeout(()=>{n.Transform.Fill="green"},200))})}u.play();
