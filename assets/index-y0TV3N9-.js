var I=Object.defineProperty;var b=(r,e,t)=>e in r?I(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>b(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=t(i);fetch(i.href,h)}})();class m{constructor(e){n(this,"Object");this.Object=e}update(e){}}class P{static new(){const e="0123456789ABCDEF";return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/x/g,()=>e.charAt(Math.random()*e.length))}}class l{constructor(e,t){n(this,"X");n(this,"Y");this.X=e,this.Y=t}add(e){return new l(this.X+e.X,this.Y+e.Y)}subtract(e){return new l(this.X-e.X,this.Y-e.Y)}normalize(){const e=this.Length;return new l(this.X/e,this.Y/e)}dot(e){return this.X*e.X+this.Y*e.Y}multiply(e){return new l(this.X*e,this.Y*e)}distance(e){return this.subtract(e).Length}get Length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}get IsZero(){return this.X===0&&this.Y===0}}class g extends Number{toDegree(){return this.valueOf()*180/Math.PI}toRadian(){return this.valueOf()}static degree(e){return new g(e*Math.PI/180)}static byPoints(e,t){const s=e instanceof c?e.Transform.Position:e,i=t instanceof c?t.Transform.Position:t;return new g(Math.atan2(i.Y-s.Y,i.X-s.X))}}class B{constructor(e,t){n(this,"Width");n(this,"Height");this.Width=e,this.Height=t}}class A{constructor(e,t,s=new B(1,1)){n(this,"_Scale");n(this,"_Width");n(this,"_Height");this._Scale=s,this._Width=e*s.Width,this._Height=t*s.Height}get Scale(){return this._Scale}set Scale(e){this._Scale=e}get Width(){return this._Width}set Width(e){this._Width=e*this.Scale.Width}get Height(){return this._Height}set Height(e){this._Height=e*this.Scale.Height}}class a{static Float(e,t){return typeof t>"u"?Math.random()*e:Math.random()*(t-e+1)+e}static Integer(e,t){return Math.floor(a.Float(e,t))}static ColorRGB(){return`rgb(${a.Integer(255)}, ${a.Integer(255)}, ${a.Integer(255)})`}static ColorHEX(){const e="0123456789ABCDEF";return"#xxxxxx".replace(/x/g,()=>e.charAt(Math.random()*e.length))}static Boolean(){return a.Integer(0,1)===1}static Angle(e=360){return g.degree(a.Integer(e))}static Vector2D(e,t){return new l(Math.random()*e,Math.random()*t)}}const u=class u{constructor(e){n(this,"Name");n(this,"Id");n(this,"Tags");n(this,"_onDestroy");n(this,"_onUpdate");this.Id=P.new(),this.Name=e,this.Tags=[],u.add(this)}onDestroy(e){this._onDestroy=e}onUpdate(e){this._onUpdate=e}addTag(e){this.Tags.push(e)}destroy(){var e;u.delete(this.Id),(e=this._onDestroy)==null||e.apply(this)}static get AllAsArray(){return Array.from(this.All,([e,t])=>t).filter(e=>e.constructor.name===this.name)}static add(e){if(u.findById(e.Id))throw new Error(`ОШИБКА: ${this.name} c идентификатором '${e.Id}' уже существует.`);this.All.set(e.Id,e)}static findById(e){return this.AllAsArray.find(t=>this.name===t.constructor.name&&t.Id===e)??null}static findByName(e){return this.AllAsArray.find(t=>this.name===t.constructor.name&&t.Name===e)??null}static selectByTag(e){return this.AllAsArray.filter(t=>t.Tags.includes(e))}static showAll(){return this.AllAsArray}static delete(e){this.All.delete(e)}};n(u,"All",new Map);let y=u;class w extends y{constructor(t,s,i,h){super(s??`GameScreen_${w.showAll().length+1}`);n(this,"_LastTime",0);n(this,"_Loop",0);n(this,"_GameEngine",new T);n(this,"Scenes");n(this,"Canvas");n(this,"Context");n(this,"_onAddScene");n(this,"_onClick");n(this,"_onRightClick");n(this,"_onMouseMove");n(this,"play",(t=0)=>{const s=(t-this._LastTime)/1e3;this._LastTime=t,this.update(s),this._Loop=requestAnimationFrame(this.play)});n(this,"pause",()=>{cancelAnimationFrame(this._Loop)});n(this,"_IsShowFPS",!1);n(this,"_Times",[]);n(this,"_onShowFPS",()=>{const t=performance.now();for(;this._Times.length>0&&this._Times[0]<=t-1e3;)this._Times.shift();return this._Times.push(t),this._Times.length});n(this,"showFPS",(t=!0)=>{this._IsShowFPS=t});n(this,"_IsShowEntitiesCount",!1);n(this,"showEntitiesCount",(t=!0)=>{this._IsShowEntitiesCount=t});this.Scenes=new Map,this.Canvas=document.createElement("canvas"),this.Context=this.Canvas.getContext("2d"),t.appendChild(this.Canvas),this._setSize(),window.addEventListener("resize",()=>{this._setSize()}),window.addEventListener("click",o=>{var d;(d=this._onClick)==null||d.apply(this,[new l(o.clientX,o.clientY),this])}),window.addEventListener("contextmenu",o=>{var d;o.stopPropagation(),(d=this._onRightClick)==null||d.apply(this,[new l(o.clientX,o.clientY),this])}),window.addEventListener("mousemove",o=>{var d;(d=this._onMouseMove)==null||d.apply(this,[new l(o.clientX,o.clientY),this])})}_setSize(){this.Canvas.width=innerWidth,this.Canvas.height=innerHeight,this.Canvas.style.cssText="position: absolute; top: 0; left: 0;"}get Width(){return this.Canvas.width}get Height(){return this.Canvas.height}onAddScene(t){this._onAddScene=t}onClick(t){this._onClick=t}onRightClick(t){this._onRightClick=t}onMouseMove(t){this._onMouseMove=t}addScene(t){var i;const s=new f(this,t);if(this.findSceneById(s.Id)!==null)throw new Error(`ОШИБКА: ${s.constructor.name} с идентификатором '${s.Id}' уже существует.`);return this.Scenes.set(s.Id,s),(i=this._onAddScene)==null||i.apply(this,[s]),s}destroyScene(t){var s;(s=f.findById(t))==null||s.destroy()}findSceneById(t){return this.Scenes.get(t)??null}update(t){var s,i;this._GameEngine.update(t),(s=this.Context)==null||s.clearRect(0,0,this.Width,this.Height),this.Scenes.forEach(h=>{var o;h.update(t),(o=this.Context)==null||o.restore()}),(i=this._onUpdate)==null||i.apply(this,[t]),this._IsShowFPS&&(this.Context.beginPath(),this.Context.globalAlpha=.75,this.Context.fillStyle="black",this.Context.fillRect(10,10,70,24),this.Context.closePath(),this.Context.beginPath(),this.Context.globalAlpha=1,this.Context.textAlign="center",this.Context.strokeStyle="#00fb00",this.Context.textBaseline="middle",this.Context.font="lighter 18px sans-serif",this.Context.moveTo(35,22),this.Context.fillStyle="#00fb00",this.Context.fillText(`FPS: ${this._onShowFPS()}`,45,22,70),this.Context.closePath()),this._IsShowEntitiesCount&&(this.Context.beginPath(),this.Context.globalAlpha=.75,this.Context.fillStyle="black",this.Context.fillRect(10,35,100,24),this.Context.closePath(),this.Context.beginPath(),this.Context.globalAlpha=1,this.Context.textAlign="left",this.Context.strokeStyle="#00fb00",this.Context.font="lighter 18px sans-serif",this.Context.moveTo(10,35),this.Context.fillStyle="#00fb00",this.Context.fillText(`Count: ${c.AllAsArray.length}`,10,47),this.Context.closePath())}destroy(){var t;(t=this.Canvas.parentElement)==null||t.removeChild(this.Canvas),this.Scenes.forEach(s=>s.destroy()),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return this.AllAsArray}}class f extends y{constructor(t,s){super(s??`GameScene_${f.showAll().length+1}`);n(this,"Layers");n(this,"Screen");n(this,"_onAddLayer");this.Layers=new Map,this.Screen=t}onAddLayer(t){this._onAddLayer=t}update(t){this.Layers.forEach(s=>s.update(t))}addLayer(t){var i;const s=new _(this,t);if(this.findLayerById(s.Id)!==null)throw new Error(`ОШИБКА: ${s.constructor.name} с идентификатором '${s.Id}' уже существует.`);return this.Layers.set(s.Id,s),(i=this._onAddLayer)==null||i.apply(this,[s]),s}destroyLayer(t){var s;(s=this.findLayerById(t))==null||s.destroy()}findLayerById(t){return this.Layers.get(t)??null}destroy(){this.Layers.forEach(t=>t.destroy()),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return super.showAll()}}class _ extends y{constructor(t,s){super(s??`GameLayer_${_.showAll().length+1}`);n(this,"Objects");n(this,"Scene");n(this,"_onAddObject");this.Objects=new Map,this.Scene=t}onAddObject(t){this._onAddObject=t}update(t){this.Objects.forEach(s=>s.update(t))}createObject(t){var i;const s=new c(this,t);if(this.findObjectById(s.Id)!==null)throw new Error(`ОШИБКА: ${s.constructor.name} с идентификатором '${s.Id}' уже существует.`);return this.Objects.set(s.Id,s),(i=this._onAddObject)==null||i.apply(this,[s]),s}addObject(t){var s;return this.Objects.set(t.Id,t),(s=this._onAddObject)==null||s.apply(this,[t]),t}destroyObject(t){this.Objects.delete(t)}findObjectById(t){return this.Objects.get(t)??null}destroy(){this.Objects.forEach(t=>t.destroy()),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return super.showAll()}}class c extends y{constructor(t,s){super(s??`GameObject_${c.showAll().length+1}`);n(this,"_Layer");n(this,"Components");this.Components=new Map,this.Layer=t,[S].forEach(i=>this.addComponent(i))}get Layer(){return this._Layer}set Layer(t){t.addObject(this),this._Layer=t}get Transform(){return this.getComponent(S)}addComponent(t){const s=new t(this);return this.Components.set(t.name,s),s}getComponent(t){const s=this.Components.get(t.name);if(s===void 0)throw new Error(`ОШИБКА: Компонент '${t.name}' не найден.`);return s}tryGetComponent(t){return this.Components.get(t.name)}destroyComponent(t){this.Components.delete(t.name)}update(t){var s;this.Components.forEach(i=>{i.update(t)}),(s=this._onUpdate)==null||s.apply(this,[t])}destroy(){this.Layer.destroyObject(this.Id),super.destroy()}static findById(t){return super.findById(t)}static findByName(t){return super.findByName(t)}static selectByTag(t){return super.selectByTag(t)}static showAll(){return super.showAll()}static selectByComponent(t){return super.showAll().filter(s=>s instanceof c&&s.tryGetComponent(t))}}class T{constructor(){n(this,"_Gravity",0);n(this,"_MetrByPixels",1)}get Gravity(){return this._Gravity*this.MetrByPixels}set Gravity(e){this._Gravity=e/this.MetrByPixels}get MetrByPixels(){return this._MetrByPixels}set MetrByPixels(e){const t=this._Gravity*this._MetrByPixels;this._MetrByPixels=e,this.Gravity=t}_updatePhysic(e){}update(e){this._updatePhysic(e)}}class S extends m{constructor(){super(...arguments);n(this,"Position",new l(0,0));n(this,"Rotation",new g(0));n(this,"Size",new A(50,50));n(this,"Fill")}}class x extends m{constructor(){super(...arguments);n(this,"IsCollidable",!1);n(this,"_Forces",new Set);n(this,"_onMoving");n(this,"_onStoped")}get Forces(){return this._Forces}get Velocity(){let t=new l(0,0);return this.Forces.forEach(s=>{t=t.add(s)}),t}get IsMoving(){return!this.Velocity.IsZero}onMoving(t){this._onMoving=t}onStoped(t){this._onStoped=t}addForce(t){this._Forces.add(t)}update(t){var s,i;this.Object.Transform.Position=this.Object.Transform.Position.add(this.Velocity.multiply(t)),this.IsMoving?(s=this._onMoving)==null||s.apply(this,[this.Object,this]):(i=this._onStoped)==null||i.apply(this,[this.Object,this])}}class v extends m{get _Screen(){return this.Object.Layer.Scene.Screen}update(e){this._Screen.Context.beginPath(),this._Screen.Context.arc(this.Object.Transform.Position.X,this.Object.Transform.Position.Y,this.Object.Transform.Size.Width,0,360);const t=this._Screen.Context.createRadialGradient(this.Object.Transform.Position.X,this.Object.Transform.Position.Y,0,this.Object.Transform.Position.X,this.Object.Transform.Position.Y,this.Object.Transform.Size.Width);t.addColorStop(0,this.Object.Transform.Fill??"red"),t.addColorStop(1,"rgba(0, 0, 0, 0)"),this._Screen.Context.fillStyle=t,this._Screen.Context.fill(),this._Screen.Context.closePath()}}class C extends m{constructor(){super(...arguments);n(this,"_Dictionary",new Map)}set(t,s){this._Dictionary.set(t,s)}get(t){return this._Dictionary.get(t)}}const p=new w(document.body),L=p.addScene(),M=L.addLayer();p.onMouseMove(r=>{for(let e=0;e<25;e++){const t=new c(M);t.addComponent(v),t.addComponent(x),t.addComponent(C);const s=t.getComponent(C);s.set("opacity",a.Float(.65)),s.set("size",new A(a.Integer(2,10),0)),s.set("point",r),t.Transform.Position=new l(r.X+a.Integer(-5,5),r.Y+a.Integer(-5,5)),t.Transform.Size=s.get("size"),t.Transform.Fill=`rgba(51, 51, 51, ${s.get("opacity")})`;const i=t.getComponent(x);i.addForce(new l(a.Integer(15),a.Integer(15))),i.addForce(new l(0,a.Integer(-150,-100)))}});p.onUpdate(()=>{c.showAll().forEach(e=>{const t=e.getComponent(C),s=t.get("opacity")-a.Float(10)*.001-.001,i=t.get("size");s<0||i.Width<0?e.destroy():(t.set("opacity",s),e.Transform.Fill=`rgba(51, 51, 51, ${s})`,a.Integer(1)===1&&e.getComponent(x).addForce(t.get("point").subtract(e.Transform.Position)))})});p.showFPS();p.showEntitiesCount();p.play();
